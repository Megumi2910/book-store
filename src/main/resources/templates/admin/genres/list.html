<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin/layout/base}">
<head>
    <title>Genres - Admin</title>
</head>
<body>
    <div layout:fragment="content">
        <!-- Page Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 class="mb-1">üè∑Ô∏è Genre Management</h2>
                <p class="text-muted mb-0">Organize books by genres</p>
            </div>
            <a th:href="@{/admin/genres/new}" class="btn btn-primary">
                <i class="bi bi-plus-circle me-2"></i>
                Add New Genre
            </a>
        </div>

        <!-- Genres Table -->
        <div class="card">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th style="width: 80px;">ID</th>
                                <th>Genre Name</th>
                                <th style="width: 150px;">Book Count</th>
                                <th style="width: 200px;">Actions</th>
                            </tr>
                        </thead>
                        <tbody th:if="${genres != null and !genres.isEmpty()}">
                            <tr th:each="genre : ${genres}">
                                <!-- ID -->
                                <td>
                                    <span class="badge bg-secondary" th:text="${genre.id}">0</span>
                                </td>
                                <!-- Name -->
                                <td>
                                    <strong th:text="${genre.name}">Genre Name</strong>
                                </td>
                                <!-- Book Count -->
                                <td>
                                    <span class="badge bg-info" th:text="${(genre.bookCount != null ? genre.bookCount : 0) + ' books'}">0 books</span>
                                </td>
                                <!-- Actions -->
                                <td>
                                    <div class="btn-group" role="group">
                                        <a th:href="@{/admin/genres/{id}/edit(id=${genre.id})}" 
                                           class="btn btn-sm btn-outline-primary mx-2" title="Edit">
                                            <i class="bi bi-pencil"></i> Edit
                                        </a>
                                        <form th:action="@{/admin/genres/{id}/delete(id=${genre.id})}" 
                                              method="post" style="display: inline;"
                                              onsubmit="return confirmDelete('Are you sure you want to delete this genre?');">
                                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                            <button type="submit" class="btn btn-sm btn-outline-danger" 
                                                    title="Delete"
                                                    th:disabled="${genre.bookCount != null and genre.bookCount > 0}">
                                                <i class="bi bi-trash"></i> Delete
                                            </button>
                                        </form>
                                    </div>
                                    <div th:if="${genre.bookCount != null and genre.bookCount > 0}">
                                        <small class="text-muted">Cannot delete (has books)</small>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                        <tbody th:if="${genres == null or genres.isEmpty()}">
                            <tr>
                                <td colspan="4" class="text-center py-5 text-muted">
                                    <i class="bi bi-inbox fs-1 d-block mb-3"></i>
                                    <p class="mb-0">No genres found</p>
                                    <a th:href="@{/admin/genres/new}" class="btn btn-primary mt-3">
                                        <i class="bi bi-plus-circle me-2"></i>
                                        Add Your First Genre
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Quick Stats Card -->
        <div class="row mt-4" th:if="${genres != null and !genres.isEmpty()}">
            <div class="col-md-4">
                <div class="card stats-card">
                    <div class="card-body text-center">
                        <i class="bi bi-tags-fill text-primary fs-3"></i>
                        <h4 class="mb-0 mt-2" th:text="${genres.size()}">0</h4>
                        <small class="text-muted">Total Genres</small>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card stats-card">
                    <div class="card-body text-center">
                        <i class="bi bi-book-fill text-success fs-3"></i>
                        <h4 class="mb-0 mt-2" th:text="${totalBooks ?: 0}">0</h4>
                        <small class="text-muted">Total Books Categorized</small>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card stats-card">
                    <div class="card-body text-center">
                        <i class="bi bi-star-fill text-warning fs-3"></i>
                        <h4 class="mb-0 mt-2" th:text="${avgBooksPerGenre != null ? #numbers.formatDecimal(avgBooksPerGenre, 1, 1) : '0.0'}">0.0</h4>
                        <small class="text-muted">Avg Books per Genre</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Info Card -->
        <div class="alert alert-info mt-4" role="alert">
            <h5 class="alert-heading"><i class="bi bi-info-circle me-2"></i>About Genres</h5>
            <p class="mb-0">
                Genres help organize your book catalog. You can assign multiple genres to each book.
                Genres with associated books cannot be deleted unless those books are removed or reassigned first.
            </p>
        </div>
    </div>
</body>
</html>

