<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin/layout/base}">
<head>
    <title th:text="${'View Book - ' + book.title}">Book Details</title>
</head>
<body>
    <div layout:fragment="content">
        <!-- Page Header -->
        <div class="mb-4">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a th:href="@{/admin/dashboard}">Dashboard</a></li>
                    <li class="breadcrumb-item"><a th:href="@{/admin/books}">Books</a></li>
                    <li class="breadcrumb-item active">Book Details</li>
                </ol>
            </nav>
            <div class="d-flex justify-content-between align-items-center">
                <h2 class="mb-0">ðŸ“– Book Details</h2>
                <div>
                    <a th:href="@{/admin/books/{id}/edit(id=${book.bookId})}" class="btn btn-primary">
                        <i class="bi bi-pencil me-1"></i> Edit Book
                    </a>
                    <a th:href="@{/admin/books}" class="btn btn-outline-secondary">
                        <i class="bi bi-arrow-left me-1"></i> Back to List
                    </a>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Book Information Card -->
            <div class="col-lg-8">
                <div class="card mb-4">
                    <div class="card-header bg-white">
                        <h5 class="mb-0">Book Information</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 text-center mb-3 mb-md-0">
                                <img th:src="${book.imageUrl != null ? book.imageUrl : '/images/placeholder.jpg'}" 
                                     alt="Book cover" 
                                     class="img-fluid rounded shadow-sm"
                                     style="max-height: 300px;">
                            </div>
                            <div class="col-md-8">
                                <!-- Title -->
                                <h3 th:text="${book.title}">Book Title</h3>
                                
                                <!-- Author -->
                                <p class="text-muted mb-2">
                                    <strong>by</strong> <span th:text="${book.author}">Author Name</span>
                                </p>

                                <!-- Rating -->
                                <div class="mb-3" th:if="${book.reviewCount > 0}">
                                    <span class="text-warning">
                                        <i class="bi bi-star-fill"></i>
                                        <i class="bi bi-star-fill"></i>
                                        <i class="bi bi-star-fill"></i>
                                        <i class="bi bi-star-fill"></i>
                                        <i class="bi bi-star-half"></i>
                                    </span>
                                    <span th:text="${#numbers.formatDecimal(book.averageRating, 1, 1)}">4.5</span>
                                    <small class="text-muted" th:text="${'(' + book.reviewCount + ' reviews)'}">0 reviews</small>
                                </div>

                                <!-- Genres -->
                                <div class="mb-3">
                                    <strong>Genres:</strong>
                                    <span th:each="genreName, iterStat : ${genreNames}">
                                        <span class="badge bg-secondary" th:text="${genreName}">Genre</span>
                                        <span th:unless="${iterStat.last}">&nbsp;</span>
                                    </span>
                                </div>

                                <!-- Price & Stock -->
                                <div class="mb-3">
                                    <div class="row">
                                        <div class="col-6">
                                            <strong>Price:</strong>
                                            <h4 class="text-primary mb-0" th:text="${#numbers.formatInteger(book.price.longValue(), 1, 'COMMA')} + ' VND'">0 VND</h4>
                                        </div>
                                        <div class="col-6">
                                            <strong>Stock:</strong>
                                            <h4 class="mb-0">
                                                <span class="badge" 
                                                      th:classappend="${book.quantity < 10} ? 'bg-danger' : 
                                                                      (${book.quantity < 50} ? 'bg-warning text-dark' : 'bg-success')"
                                                      th:text="${book.quantity + ' units'}">
                                                    0 units
                                                </span>
                                            </h4>
                                        </div>
                                    </div>
                                </div>

                                <!-- ISBN -->
                                <div class="mb-2" th:if="${book.isbn != null and !book.isbn.isEmpty()}">
                                    <strong>ISBN:</strong> 
                                    <span class="font-monospace" th:text="${book.isbn}">ISBN</span>
                                </div>

                                <!-- Publisher -->
                                <div class="mb-2" th:if="${book.publisher != null and !book.publisher.isEmpty()}">
                                    <strong>Publisher:</strong> 
                                    <span th:text="${book.publisher}">Publisher</span>
                                </div>

                                <!-- Publish Date -->
                                <div class="mb-2" th:if="${book.publishDate != null}">
                                    <strong>Publish Date:</strong> 
                                    <span th:text="${#temporals.format(book.publishDate, 'MMMM dd, yyyy')}">Date</span>
                                </div>
                            </div>
                        </div>

                        <!-- Description -->
                        <hr class="my-4">
                        <div th:if="${book.description != null and !book.description.isEmpty()}">
                            <h5>Description</h5>
                            <p class="text-muted" th:text="${book.description}">Book description...</p>
                        </div>
                        <div th:unless="${book.description != null and !book.description.isEmpty()}">
                            <p class="text-muted fst-italic">No description available.</p>
                        </div>
                    </div>
                </div>

                <!-- Actions Card -->
                <div class="card">
                    <div class="card-header bg-white">
                        <h5 class="mb-0">Quick Actions</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2 d-md-flex">
                            <a th:href="@{/admin/books/{id}/edit(id=${book.bookId})}" class="btn btn-primary">
                                <i class="bi bi-pencil me-1"></i> Edit Book
                            </a>
                            <button class="btn btn-outline-secondary" onclick="alert('Coming soon!')">
                                <i class="bi bi-graph-up me-1"></i> View Sales Report
                            </button>
                            <button class="btn btn-outline-secondary" onclick="alert('Coming soon!')">
                                <i class="bi bi-star me-1"></i> View Reviews
                            </button>
                            <form th:action="@{/admin/books/{id}/delete(id=${book.bookId})}" 
                                  method="post" class="d-inline"
                                  onsubmit="return confirmDelete('Are you sure you want to delete this book? This action cannot be undone.');">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                <button type="submit" class="btn btn-outline-danger">
                                    <i class="bi bi-trash me-1"></i> Delete Book
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Metadata Sidebar -->
            <div class="col-lg-4">
                <!-- Metadata Card -->
                <div class="card mb-4">
                    <div class="card-header bg-white">
                        <h5 class="mb-0">Metadata</h5>
                    </div>
                    <div class="card-body">
                        <table class="table table-sm table-borderless mb-0">
                            <tr>
                                <td><strong>Book ID:</strong></td>
                                <td th:text="${book.bookId}">0</td>
                            </tr>
                            <tr>
                                <td><strong>Created:</strong></td>
                                <td th:text="${#temporals.format(book.createdAt, 'MMM dd, yyyy HH:mm')}">Date</td>
                            </tr>
                            <tr>
                                <td><strong>Last Updated:</strong></td>
                                <td th:text="${#temporals.format(book.updatedAt, 'MMM dd, yyyy HH:mm')}">Date</td>
                            </tr>
                            <tr>
                                <td><strong>Version:</strong></td>
                                <td th:text="${book.version}">0</td>
                            </tr>
                        </table>
                    </div>
                </div>

                <!-- Statistics Card -->
                <div class="card">
                    <div class="card-header bg-white">
                        <h5 class="mb-0">Statistics</h5>
                    </div>
                    <div class="card-body">
                        <div class="text-center mb-3">
                            <i class="bi bi-star-fill text-warning fs-1"></i>
                            <h3 class="mb-0" th:text="${#numbers.formatDecimal(book.averageRating ?: 0, 1, 1)}">0.0</h3>
                            <small class="text-muted" th:text="${book.reviewCount + ' reviews'}">0 reviews</small>
                        </div>
                        <hr>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Total Sales:</span>
                            <strong class="text-muted">Coming soon</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Revenue Generated:</span>
                            <strong class="text-muted">Coming soon</strong>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span>Views:</span>
                            <strong class="text-muted">Coming soon</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>

